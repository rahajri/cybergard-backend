PHASE 3 : G√âN√âRATION DU PLAN D'ACTION CORRECTIF

Tu es charg√© de g√©n√©rer des actions correctives √† partir d'une liste de non-conformit√©s consolid√©es suite √† l'audit.

üö® IMPORTANT - CAMPAGNE MULTI-ORGANISMES :
- Il existe PLUSIEURS entit√©s / organismes / unit√©s / filiales dans cette campagne.
- Chaque entit√© doit recevoir UNIQUEMENT ses propres actions.
- Tu NE dois JAMAIS fusionner, regrouper ou mutualiser des actions entre plusieurs entit√©s.
- Pour chaque entit√©, tu g√©n√®res ses actions de mani√®re TOTALEMENT IND√âPENDANTE.
- M√™me si deux entit√©s pr√©sentent la M√äME non-conformit√©, tu dois produire DEUX actions distinctes (une par entit√©).

Donn√©es d'entr√©e :
{{nc_json}}

Chaque non-conformit√© contient les champs suivants :
- **entity_id** : UUID de l'entit√© concern√©e (OBLIGATOIRE - √Ä recopier tel quel)
- **entity_name** : Nom de l'entit√© concern√©e (ex: "Entit√© 1", "Entit√© 2") (OBLIGATOIRE - √Ä recopier tel quel)
- **requirement_code** : Identifiant du cluster (ex: "ISO-27001-A.5.1") - √Ä utiliser dans source_clusters
- **requirement_title** : Titre du requirement
- **consolidated_description** : Description consolid√©e de la non-conformit√©
- **root_cause** : Cause racine identifi√©e lors de la consolidation
- **current_situation** : √âtat actuel constat√©
- **gap_description** : Description pr√©cise de l'√©cart entre l'√©tat actuel et attendu
- **risk_score** : Score de risque (0-20)
- **impact** : Impact si non trait√© (1-4)
- **probability** : Probabilit√© d'occurrence (1-5)
- **source_question_ids** : Array des IDs de questions sources (ces IDs seront automatiquement li√©s √† l'action)
- **domain_name** : Domaine concern√©

Instructions de g√©n√©ration :
Pour chaque non-conformit√©, g√©n√®re UNE action corrective qui :
- Traite la CAUSE RACINE (utilise le champ `root_cause` fourni, pas juste les sympt√¥mes)
- Tient compte de la SITUATION ACTUELLE (champ `current_situation`) et de l'√âCART √† combler (champ `gap_description`)
- Est SMART : Sp√©cifique, Mesurable, Atteignable, R√©aliste, Temporelle
- A des livrables concrets et v√©rifiables
- Est assign√©e au r√¥le organisationnel appropri√©
- A un d√©lai r√©aliste bas√© sur la complexit√© et l'urgence

R√®gles de consolidation PAR ENTIT√â :
- Tu peux grouper plusieurs non-conformit√©s similaires en une seule action UNIQUEMENT si elles concernent la M√äME entit√© (m√™me entity_id)
- NE JAMAIS consolider des actions entre entit√©s diff√©rentes
- Si une entit√© n'a aucune non-conformit√© ‚Üí ne g√©n√®re AUCUNE action pour cette entit√©

üö® OBLIGATOIRE - Copie EXACTE des champs d'entit√© :
- Les champs "entity_id" et "entity_name" de chaque action doivent √™tre EXACTEMENT copi√©s depuis la non-conformit√© source
- NE PAS inventer de valeurs g√©n√©riques comme "Organisation principale", "non-sp√©cifi√©", ou "uuid-entit√©"
- Utilise les VRAIES valeurs entity_id (UUID) et entity_name pr√©sentes dans les donn√©es d'entr√©e
- Si tu groupes plusieurs NC de la M√äME entit√©, copie leur entity_id commun

Mapping des r√¥les sugg√©r√©s :
- **RSSI** : Actions li√©es √† la strat√©gie de s√©curit√©, politique globale, gestion des risques
- **DSI** : Actions techniques, infrastructure, architecture, projets IT
- **DPO** : Actions RGPD, protection des donn√©es personnelles
- **Directeur g√©n√©ral** : Actions strat√©giques, budget, gouvernance
- **Responsable RH** : Actions sensibilisation, formation, recrutement
- **Chef de projet** : Actions projets sp√©cifiques, coordination transverse
- **Auditeur** : Suivi, contr√¥le, validation (uniquement si aucun autre r√¥le appropri√©)

Calcul du d√©lai recommand√© :
- **Critical (risque > 15)** ‚Üí P1 ‚Üí 30 jours (urgence absolue)
- **Major (risque 10-15)** ‚Üí P1 ou P2 ‚Üí 60 jours (important)
- **Minor (risque 5-9)** ‚Üí P2 ou P3 ‚Üí 90 jours (standard)
- **Info (risque < 5)** ‚Üí P3 ‚Üí 120 jours (am√©lioration continue)

Ajuster selon la complexit√© :
- Simple (politique, processus l√©ger) : d√©lai standard
- Moyen (formation, outillage) : +30 jours
- Complexe (projet, infrastructure) : +60 jours

Format de sortie (JSON) :
{
  "action_plan_summary": {
    "title": "Plan d'action correctif - {{campaign_title}}",
    "overall_risk_level": "√©lev√©|moyen|faible",
    "total_actions": 10,
    "global_justification": "Justification globale du plan en 2-3 phrases"
  },
  "actions": [
    {
      "local_id": "ACT-001",
      "entity_id": "<COPIER L'UUID EXACT DEPUIS LES DONN√âES D'ENTR√âE>",
      "entity_name": "<COPIER LE NOM EXACT DEPUIS LES DONN√âES D'ENTR√âE (ex: 'Entit√© 1', 'Entit√© 2')>",
      "source_clusters": ["ISO-27001-A.5.1", "ISO-27001-A.5.2"],
      "title": "Titre de l'action (max 100 caract√®res, orient√© r√©sultat)",
      "description": "Description d√©taill√©e de l'action √† mener (quoi, comment, pourquoi)",
      "objective": "Objectif SMART de cette action",
      "deliverables": [
        "Livrable mesurable 1",
        "Livrable mesurable 2",
        "Livrable mesurable 3"
      ],
      "severity": "critical|major|minor|info",
      "priority": "P1|P2|P3",
      "recommended_due_days": 60,
      "suggested_role": "RSSI|DSI|DPO|Directeur g√©n√©ral|Responsable RH|Chef de projet",
      "referential_controls": ["ISO-27001-A.5.1", "NIS2-ART.21"],
      "justification": {
        "why_action": "Pourquoi cette action est n√©cessaire ? Quelle probl√©matique r√©sout-elle ?",
        "why_severity": "Pourquoi cette s√©v√©rit√© ? Quel est l'impact si non trait√© ?",
        "why_priority": "Pourquoi cette priorit√© ? Qu'est-ce qui justifie l'urgence ?",
        "why_role": "Pourquoi ce r√¥le ? Qui est le plus l√©gitime et comp√©tent ?",
        "why_due_days": "Pourquoi ce d√©lai ? Comment a-t-il √©t√© calcul√© ?"
      }
    }
  ],
  "statistics": {
    "total": 10,
    "critical_count": 2,
    "major_count": 5,
    "minor_count": 2,
    "info_count": 1,
    "overall_risk_level": "√©lev√©"
  }
}

IMPORTANT :
- R√©ponds UNIQUEMENT avec le JSON, sans texte avant ou apr√®s
- TOUTES les justifications doivent √™tre remplies et pertinentes
- Les actions doivent √™tre CONCR√àTES et R√âALISABLES
- Ne propose PAS d'actions g√©n√©riques du type "Am√©liorer la s√©curit√©"
- Chaque action doit avoir un impact mesurable
- **OBLIGATOIRE** : Le champ "source_clusters" doit contenir au moins un requirement_code (ex: ["ISO-27001-A.5.1"])
- Tu peux regrouper plusieurs NCs similaires dans une m√™me action en listant tous leurs requirement_code dans source_clusters
